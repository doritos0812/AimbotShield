# AimbotShield: Anti-Cheat Program

## 목적
AimbotShield는 AimTrainerHack이라는 이미지 기반 에임봇 프로그램을 탐지하고 차단하기 위해 개발된 안티치트 프로그램. AimTrainerHack은 데이터 패킷을 사용하지 않고, 사용자 디바이스에서 직접 마우스 입력과 화면 전환 등을 통해 작동하기 때문에 이를 모니터링하고 분석하여 Aimbot 여부를 판단해야 함.


## 24.11.12

### BitBlt 함수 호출 모니터링 시도
처음에는 AimTrainerHack이 화면을 캡처할 때 호출하는 BitBlt 함수의 호출 빈도를 모니터링하여 Aimbot 여부를 판단하려 했음.  
이를 위해 Detours 라이브러리를 사용하여 BitBlt 함수 후킹을 시도했으나, Detours로 후킹한 프로그램이 실제로 AimTrainerHack과 같은 프로세스에서 실행되도록 하려면 DLL 인젝션 방식이 필요했음.  
하지만 이 방법은 AimTrainerHack과 같은 특정 프로그램에 한정된 동작이라 너무 좁은 범위에 의존하는 방식이어서 포기.

### 마우스 이동 분석을 통한 Aimbot 탐지
이후, AimTrainerHack이 사람의 반응 속도 및 신체적 한계를 초과한 비정상적인 마우스 움직임을 감지하여 Aimbot 여부를 판단하는 방식으로 방향을 바꿨음.  
처음에는 GetCursorPos 함수를 사용하여 마우스 위치를 추적했으나, FPS 게임에서 마우스가 항상 화면 중앙에 고정되어 있어 효과적이지 않음.  
이 문제를 해결하기 위해, RawInputData를 사용하여 마우스의 이동 거리와 속도를 실시간으로 계산하여 비정상적인 마우스 움직임을 탐지하고 Aimbot 의심 여부를 확인하는 방법으로 전환.

## 현재 구현
- 현재는 마우스 이동 속도 및 방향을 실시간으로 분석하여 Aimbot 의심 메시지를 출력하는 프로그램을 구현
- 초기 단계에서는 단순히 `cout`으로 메시지를 출력하지만, 추후에는 팝업 메시지나 해당 프로그램 차단 기능 등을 추가할 예정

## 향후 계획
- 마우스 이동 패턴 분석의 정확도를 높이기 위해 알고리즘을 개선하고, 임계값을 설정하여 보다 정교한 Aimbot 탐지를 목표로 함
- 탐지된 Aimbot에 대해 팝업 메시지뿐만 아니라 실제로 프로그램 차단 기능을 추가할 계획


## 24.11.13
전체적으로 기능 추가 및 리팩토링 작업을 진행하였다.


### 피타고라스 거리 계산 추가
- 단순 dx, dy값의 절댓값을 기준으로 한 Threshold가 아닌 이동거리를 기준으로 하기 위해 대각선 길이를 계산하는 로직 추가

### 각 시그널 간 deltaTime 계산
- 기존의 Event-Driven 방식은 사용자의 하드웨어 상황에 따라 event 간 시간 차이에 변동성이 존재한다.
- 이에 대응하기 위해 각 Event의 절대 시간을 저장하고, 시간 차이를 통해 정확한 속력을 계산

### ESC 키를 통한 활성화/비활성화 기능 추가
- 계속 감지를 하다보니, 로그를 확인하기 쉽지 않고 사용자가 탐지를 멈추고 싶을 수 있으니 ESC 키를 통한 활성화/비활성화 기능 추가
- 이를 위해서 Mouse의 Raw Input 뿐만 아니라 Keyboard의 Raw Input 또한 수신하도록 핸들러 수정

### Aimbot 감지 경고 팝업 창 생성
- 단순 로그 출력이 아닌, 팝업 창 생성을 통한 직관적인 Alart

### Threshold Speed 조정 및 리펙토링
- Aimbot 탐지 기준 속도를 6000로 늘리고 전체 코드 리펙토링을 진행함.
- 크게 InputHandler, SpeedChecker, AimbotAlart 3 영역으로 분리

## 24.11.16
AimTrainerHack에서 Mouse Move Input의 크기를 조절하여 속도 검출 로직을 회피하였음.
이에 대응하기 위해 Aimbot을 판별하는 다른 로직들을 추가.

### 일정한 이동 거리 모니터링
- 마우스 이동 속도가 높을 경우에, 사람은 일정한 속도 및 이동 간격으로 마우스를 이동시키는 것은 불가능하다.
- 현재 커서 이동거리와 최근 이동거리가 동일할 경우 Count를 추가하고 이 Count가 Threshold를 넘어설 경우 Aimbot이라고 판별

### 일정한 이동 기울기 모니터링
- 마우스 이동 속도가 높을 경우에, 사람은 일정한 기울기로 마우스를 이동시키는 것은 불가능하다.
- 현재 커서 이동 기울기와 최근 이동 기울기가 동일할 경우 Count를 추가하고 이 Count가 Threshold를 넘어설 경우 Aimbot이라고 판별

### TODO
- 위의 동작, 즉 이동거리와 기울기 모니터링의 경우 특정 수치나 Threshold가 낮을 경우 사람이 충분히 재현 가능함.
- 최소 감지 거리 및 Threshold를 정교하게 설정하여 Aimbot과 사람을 구별해내는 동작을 고도화 시켜야 함

### 알림 메세지 수정
- 감지된 Aimbot 체크 로직에 따라 알림 메시지를 다르게 표출하도록 수정

### 기타 오타 수정
- AimbotAlert -> AimbotAlart

## 24.11.18
AimTrainerHack에서 Mouse Move의 직진성과 일관성을 회피하기 위해서 Input에 랜덤값을 더해주는 것을 확인
이로써, 직진성과 일관성을 감지하여 Aimbot을 검출해내는 기능은 AimTrainerHack에게 무의미 해짐
Aimbot의 특성을 살려서 이를 감지해낼 추가적인 로직이 필요

### 특정 방향으로 이동하는 방향성 모니터링
- 모든 Aimbot의 특성은 아니지만, AimTrainerHack은 상하좌우 대각선 8방향으로만 이동하는 구조로 되어 있음
   - 이 특징을 근거로 Input의 Radian 각도를 atan2를 통해 측정
   - 랜덤값을 넣어주므로, 0.2 정도의 오차 범위를 설정
- 8방향 쪽으로 이동하는 경우를 카운팅하고, 이 비율이 특정 비율을 넘어서면 Aimbot으로 판단
